<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeInvader Ad Editor</title>
    <style>
        :root {
            --bg-color: #f5f5f5;
            --text-color: #333;
            --container-bg: #fff;
            --border-color: #ddd;
            --primary-color: #4a6fa5;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --error-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
        }

        [data-theme="dark"] {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --container-bg: #1e1e1e;
            --border-color: #333;
            --primary-color: #5d8cc9;
            --secondary-color: #8a8a8a;
            --success-color: #34c759;
            --error-color: #ff3b30;
            --warning-color: #ffcc00;
            --info-color: #5ac8fa;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: var(--container-bg);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 15px;
        }

        h1 {
            color: var(--primary-color);
            font-size: 1.8rem;
        }

        .theme-toggle {
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 5px 10px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }

        .theme-toggle:hover {
            background-color: var(--border-color);
        }

        .editor-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .editor-container {
                grid-template-columns: 1fr;
            }
        }

        .input-section, .output-section {
            display: flex;
            flex-direction: column;
        }

        h2 {
            margin-bottom: 10px;
            color: var(--primary-color);
            font-size: 1.4rem;
        }

        textarea {
            width: 100%;
            height: 200px;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--container-bg);
            color: var(--text-color);
            font-family: inherit;
            resize: vertical;
        }

        .output-box {
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 12px;
            background-color: var(--container-bg);
            min-height: 200px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .category-box {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
            text-align: center;
        }

        .category-real-estate { background-color: rgba(40, 167, 69, 0.2); }
        .category-auto { background-color: rgba(0, 123, 255, 0.2); }
        .category-business { background-color: rgba(255, 193, 7, 0.2); }
        .category-work { background-color: rgba(23, 162, 184, 0.2); }
        .category-dating { background-color: rgba(220, 53, 69, 0.2); }
        .category-services { background-color: rgba(111, 66, 193, 0.2); }
        .category-discounts { background-color: rgba(253, 126, 20, 0.2); }
        .category-other { background-color: rgba(108, 117, 125, 0.2); }
        .category-rejected { background-color: rgba(220, 53, 69, 0.3); }

        .button-container {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s;
        }

        .format-btn {
            background-color: var(--primary-color);
            color: white;
        }

        .format-btn:hover {
            background-color: #3a5a8c;
        }

        .clear-btn {
            background-color: var(--secondary-color);
            color: white;
        }

        .clear-btn:hover {
            background-color: #5a6268;
        }

        .copy-btn {
            background-color: var(--info-color);
            color: white;
        }

        .copy-btn:hover {
            background-color: #138496;
        }

        .manual-edit-btn {
            background-color: var(--warning-color);
            color: #000;
        }

        .manual-edit-btn:hover {
            background-color: #e0a800;
        }

        .examples-section {
            margin-top: 30px;
        }

        .examples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .example-card {
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 15px;
            background-color: var(--container-bg);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .example-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .example-raw {
            font-style: italic;
            margin-bottom: 10px;
            color: var(--secondary-color);
        }

        .example-formatted {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .example-category {
            font-size: 0.8rem;
            color: var(--secondary-color);
        }

        .rejection-reason {
            color: var(--error-color);
            font-weight: bold;
            margin-top: 10px;
        }

        .manual-edit-section {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--container-bg);
        }

        .manual-edit-section h3 {
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .manual-controls {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .manual-control {
            display: flex;
            flex-direction: column;
        }

        .manual-control label {
            margin-bottom: 5px;
            font-weight: bold;
        }

        .manual-control input, .manual-control select {
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--container-bg);
            color: var(--text-color);
        }

        footer {
            margin-top: 30px;
            text-align: center;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
            color: var(--secondary-color);
            font-size: 0.9rem;
        }

        .validation-indicator {
            margin-top: 5px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
        }

        .validation-ok {
            color: var(--success-color);
        }

        .validation-error {
            color: var(--error-color);
        }

        .validation-icon {
            margin-right: 5px;
        }

        .search-container {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }

        .search-container input {
            flex: 1;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: var(--container-bg);
            color: var(--text-color);
        }

        .search-container button {
            padding: 8px 15px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px;
            border-radius: 4px;
            background-color: var(--success-color);
            color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transform: translateX(150%);
            transition: transform 0.3s;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background-color: var(--error-color);
        }

        .notification.warning {
            background-color: var(--warning-color);
            color: #000;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>LifeInvader Ad Editor</h1>
            <button class="theme-toggle" id="themeToggle">🌙 Dark Mode</button>
        </header>

        <div class="editor-container">
            <div class="input-section">
                <h2>Raw Ad Input</h2>
                <textarea id="rawAdInput" placeholder="Paste your raw ad here..."></textarea>
                <div class="validation-indicator" id="validationIndicator"></div>
                <div class="button-container">
                    <button class="format-btn" id="formatBtn">Format Ad</button>
                    <button class="clear-btn" id="clearBtn">Clear</button>
                    <button class="manual-edit-btn" id="manualEditBtn">Manual Edit</button>
                </div>
            </div>

            <div class="output-section">
                <h2>Formatted Ad Output</h2>
                <div class="output-box" id="formattedOutput">Your formatted ad will appear here...</div>
                <div class="category-box" id="categoryOutput"></div>
                <div class="rejection-reason" id="rejectionReason"></div>
                <div class="button-container">
                    <button class="copy-btn" id="copyBtn">Copy to Clipboard</button>
                </div>
            </div>
        </div>

        <div class="manual-edit-section" id="manualEditSection" style="display: none;">
            <h3>Manual Edit Controls</h3>
            <div class="manual-controls">
                <div class="manual-control">
                    <label for="manualPurpose">Purpose</label>
                    <select id="manualPurpose">
                        <option value="Selling">Selling</option>
                        <option value="Buying">Buying</option>
                        <option value="Trading">Trading</option>
                        <option value="Selling or trading">Selling or trading</option>
                        <option value="Looking for">Looking for</option>
                        <option value="Hiring">Hiring</option>
                        <option value="Renting out">Renting out</option>
                    </select>
                </div>
                <div class="manual-control">
                    <label for="manualCategory">Category</label>
                    <select id="manualCategory">
                        <option value="Real Estate">Real Estate</option>
                        <option value="Auto">Auto</option>
                        <option value="Business">Business</option>
                        <option value="Work">Work</option>
                        <option value="Dating">Dating</option>
                        <option value="Services">Services</option>
                        <option value="Discounts">Discounts</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="manual-control">
                    <label for="manualPrice">Price/Budget/Rent</label>
                    <input type="text" id="manualPrice" placeholder="e.g. $2.5 Million">
                </div>
                <div class="manual-control">
                    <label for="manualItem">Item/Vehicle/Business</label>
                    <input type="text" id="manualItem" placeholder="Item name">
                </div>
            </div>
            <div class="button-container">
                <button class="format-btn" id="applyManualBtn">Apply Changes</button>
                <button class="clear-btn" id="cancelManualBtn">Cancel</button>
            </div>
        </div>

        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Search rules, items, vehicles...">
            <button class="format-btn" id="searchBtn">Search</button>
        </div>

        <div class="examples-section">
            <h2>Example Ads</h2>
            <p>Try these examples to test the formatter:</p>
            <div class="examples-grid" id="examplesGrid">
                <!-- Examples will be populated by JavaScript -->
            </div>
        </div>

        <footer>
            <p>LifeInvader Internal Policy EN-03 | Last updated: 28-04-2025</p>
        </footer>
    </div>

    <div class="notification" id="notification">Copied to clipboard!</div>

    <script>
        // Theme toggle functionality
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;

        themeToggle.addEventListener('click', () => {
            if (body.getAttribute('data-theme') === 'dark') {
                body.removeAttribute('data-theme');
                themeToggle.textContent = '🌙 Dark Mode';
            } else {
                body.setAttribute('data-theme', 'dark');
                themeToggle.textContent = '☀️ Light Mode';
            }
        });

        // Format button functionality
        const formatBtn = document.getElementById('formatBtn');
        const clearBtn = document.getElementById('clearBtn');
        const copyBtn = document.getElementById('copyBtn');
        const manualEditBtn = document.getElementById('manualEditBtn');
        const applyManualBtn = document.getElementById('applyManualBtn');
        const cancelManualBtn = document.getElementById('cancelManualBtn');
        const searchBtn = document.getElementById('searchBtn');
        const rawAdInput = document.getElementById('rawAdInput');
        const formattedOutput = document.getElementById('formattedOutput');
        const categoryOutput = document.getElementById('categoryOutput');
        const rejectionReason = document.getElementById('rejectionReason');
        const examplesGrid = document.getElementById('examplesGrid');
        const manualEditSection = document.getElementById('manualEditSection');
        const manualPurpose = document.getElementById('manualPurpose');
        const manualCategory = document.getElementById('manualCategory');
        const manualPrice = document.getElementById('manualPrice');
        const manualItem = document.getElementById('manualItem');
        const searchInput = document.getElementById('searchInput');
        const validationIndicator = document.getElementById('validationIndicator');
        const notification = document.getElementById('notification');

        // Vehicle database
        const vehicleDatabase = [
            "Adder", "Baller", "Calico GTF", "Declasse Corvette C7", "Elegy Retro Custom", "F620", 
            "Gallivanter Defender", "Hermes", "Imorgon", "Jackal", "Kamacho", "Lampadati Giulia GTA", 
            "Mamba", "Nebula Turbo", "Oracle", "Panto", "Raiden", "Sabre Turbo", "T-20", 
            "Ubermacht 760 (LI)", "V-STR", "Warrener", "X80 Proto", "Yosemite", "Z-Type", "9F",
            "Annis Silvia (S15)", "Annis Skyline GT-R (R34)", "Annis RX-7 (FD)", "Benefactor-MG C63 (W205)",
            "Benefactor-Benz 600SEL (W140)", "Benefactor-Maybach Pullman", "Grotti Italia (F458)",
            "Karin Supra A80", "Karin Tundra 2021", "Truffade Chiron", "Obey R8", "Enus Phantom",
            "Progen 675 LT", "Swift Deluxe", "Frogger", "SuperVolito Carbon", "SeaShark", "Monowheel"
        ];

        // Non-sellable vehicles
        const nonSellableVehicles = [
            "Annis Concept 2021", "Brabus Rocket G900", "Bravado Charger Daytona", "Enus EXP 10",
            "Genesis G90", "KMTA Optima", "Overflod Jesko 2020", "Pfister Cayenne", "Shelby Cobra Daytona",
            "Truffade Centodieci", "Ubermacht M5 (F90)", "Vapid Focus RS", "Benefactor-MG G63 (6X6)"
        ];

        // Clothing database
        const clothingDatabase = [
            "Abibas pants", "Abibas Pezy Boost 700 V3 Alvah shoes", "Lui Vi pants", "Lui Vi full set",
            "TRON full set", "TRON helmet", "Grand RP trousers", "Grand RP collection T-shirt",
            "Grand RP collection pants", "Mikachu hoodie", "The West Pace jacket", "Pans sneakers",
            "Niki Groundporce One new collection shoes", "RGB neon shoes", "Ground Mordan 4 Retro Laser 30th shoes",
            "white tied scarf mask", "black Lui Vi desert scarf mask", "luminous head bag mask"
        ];

        // Business types
        const businessTypes = [
            "Ammunition Store", "Bar", "Car wash", "Chip tuning", "Clothing shop", "Cowshed",
            "Electric station", "Farm", "Flower shop", "Freight train", "Gas station", "Grand Elite",
            "Hair salon", "Oil Well", "Parking", "Pet Shop", "Plantation", "Car sharing", "State object",
            "Service station", "24/7 Store", "Tattoo studio", "Taxi company", "ATM business", "Juice shop",
            "Burger shop", "Jewelry store", "Fight club"
        ];

        // Illegal items
        const illegalItems = [
            'firearm', 'ammunition', 'bulletproof', 'armor plate', 'weed', 'cannabis', 'cocaine', 'drug',
            'ems mask', 'medical mask', 'covid mask', 'scanner', 'radar', 'balaclava', 'rope', 'head bag',
            'usb with virus', 'lock pick', 'crowbar', 'troll', 'bandit mask', 'animal skin', 'satellite dish',
            'barricade', 'anti-radar', 'engine block', 'air horn', 'grand coin', 'battlepass', 'hype body',
            'gang', 'nationality', 'sale of people', 'sexual', 'birthday', 'playboy family', 'license',
            'mega mall', 'gang hq', 'black market', 'lspd', 'fib', 'sahp', 'ems', 'government', 'ghetto'
        ];

        // Example ads data
        const exampleAds = [
            {
                raw: "selling monowheel budget 2.5m",
                formatted: 'Selling "Monowheel". Price: $2.5 Million.',
                category: "Auto"
            },
            {
                raw: "I want to but a penthouse. My budget is 20 mil",
                formatted: "Buying Casino penthouse. Budget: $20 Million.",
                category: "Real Estate"
            },
            {
                raw: "selling house 71 and 1008. Price nego",
                formatted: "Cannot advertise more than 1 property at a time.",
                category: "Rejected",
                rejection: "Cannot advertise more than 1 property at a time."
            },
            {
                raw: "buying a biz. Budget 150 mil",
                formatted: "Buying a private business. Budget: $150 Million.",
                category: "Business"
            },
            {
                raw: "selling state object in city.",
                formatted: "Selling State object business in city. Price: Negotiable.",
                category: "Business"
            },
            {
                raw: "looking Anindo winslow",
                formatted: "Looking for Anindo Winslow.",
                category: "Dating"
            },
            {
                raw: "i am a lawyer, i need work",
                formatted: "Lawyer looking for work.",
                category: "Work"
            },
            {
                raw: "i want to plant solar",
                formatted: "Looking for solar panel plantation work.",
                category: "Work"
            },
            {
                raw: "sell supra, price 10 mil",
                formatted: 'Selling "Karin Supra A80". Price: $10 Million.',
                category: "Auto"
            },
            {
                raw: "buying p1. Budget nego",
                formatted: "Cannot advertise this vehicle is non sellable.",
                category: "Rejected",
                rejection: "Cannot advertise this vehicle is non sellable."
            },
            {
                raw: "party at fib",
                formatted: "Cannot promote parties at FIB.",
                category: "Rejected",
                rejection: "Cannot promote parties at FIB."
            },
            {
                raw: "buying seed bulk. 2500 each",
                formatted: "Buying seeds in bulk. Budget: $2.500 each.",
                category: "Other"
            },
            {
                raw: "sell a rp ticket",
                formatted: "Selling a Grand ticket. Price: Negotiable.",
                category: "Other"
            },
            {
                raw: "buy grand coin",
                formatted: "Cannot promote illegal items.",
                category: "Rejected",
                rejection: "Cannot promote illegal items."
            },
            {
                raw: "i need cocain. 8k each.",
                formatted: "Cannot promote illegal items.",
                category: "Rejected",
                rejection: "Cannot promote illegal items."
            },
            {
                raw: "Selling house 503, garden, 25 garage, swimming pool, custom interior in mirror park. Price : 50 mil",
                formatted: "Selling house №503 with a garden, 25 g.s., custom interior and swimming pool in Mirror Park. Price: $50 Million.",
                category: "Real Estate"
            },
            {
                raw: "i have a house for rent, 250k per week",
                formatted: "Renting out a house. Rent: $250.000 per week.",
                category: "Real Estate"
            },
            {
                raw: "buying swift deluxe, price 10 million",
                formatted: 'Buying "Swift Deluxe". Budget: $10 Million.',
                category: "Auto"
            },
            {
                raw: "selling a seashark.",
                formatted: 'Selling "SeaShark". Price: Negotiable.',
                category: "Auto"
            },
            {
                raw: "selling gun store 269 price 500m",
                formatted: "Selling Ammunition Store №269. Price: Negotiable.",
                category: "Business"
            },
            {
                raw: "looking to buy juice shop",
                formatted: "Buying Juice shop business. Budget: Negotiable.",
                category: "Business"
            },
            {
                raw: "i need a girlfriend",
                formatted: "Looking for a girlfriend.",
                category: "Dating"
            },
            {
                raw: "selling 20 taxi share",
                formatted: "Selling 20 Taxi fleet shares. Price: Negotiable.",
                category: "Business"
            },
            {
                raw: "buying boys Adidas pant. 80 mil",
                formatted: "Buying Abibas pants for men. Budget: $80 Million.",
                category: "Other"
            },
            {
                raw: "sell 2pcs level 2 engine. 3pcs lvl 2 tire and 2pcs lvl 3 transmission. price 900k, 200k and 300k each.",
                formatted: "Selling 2 medium quality engine, 3 medium quality tires and 2 high quality transmission tunings. Price: $900.000, $200.000 and $300.000 each respectively.",
                category: "Other"
            },
            {
                raw: "selling chiron with max tuning parts, full chip tuning, modification, insurance, turbo and drift kit for 30 million",
                formatted: 'Selling "Truffade Chiron" with full configuration, visual upgrades, insurance, turbo kit and drift kit. Price: $30 Million.',
                category: "Auto"
            },
            {
                raw: "buying a lion. Budget 10 mil",
                formatted: "Buying cage with a Lion Cub. Budget: $10 Million.",
                category: "Other"
            },
            {
                raw: "selling 15 tonic treat. Budget - 90k each",
                formatted: "Selling 15 tonic treats. Price: $90.000 each.",
                category: "Other"
            },
            {
                raw: "Looking for Zandre Mortez",
                formatted: "Looking for Zandre Mortez.",
                category: "Dating"
            },
            {
                raw: "hiring family members.",
                formatted: "Looking for family members.",
                category: "Dating"
            }
        ];

        // Current ad data for manual editing
        let currentAdData = {
            purpose: "",
            category: "",
            price: "",
            item: "",
            formattedAd: ""
        };

        // Show notification
        function showNotification(message, type = "success") {
            notification.textContent = message;
            notification.className = "notification";
            notification.classList.add(type);
            notification.classList.add("show");
            
            setTimeout(() => {
                notification.classList.remove("show");
            }, 3000);
        }

        // Populate examples grid
        exampleAds.forEach(example => {
            const exampleCard = document.createElement('div');
            exampleCard.className = 'example-card';
            
            const rawText = document.createElement('div');
            rawText.className = 'example-raw';
            rawText.textContent = `Raw: ${example.raw}`;
            
            const formattedText = document.createElement('div');
            formattedText.className = 'example-formatted';
            formattedText.textContent = `Formatted: ${example.formatted}`;
            
            const categoryText = document.createElement('div');
            categoryText.className = 'example-category';
            categoryText.textContent = `Category: ${example.category}`;
            
            exampleCard.appendChild(rawText);
            exampleCard.appendChild(formattedText);
            exampleCard.appendChild(categoryText);
            
            // Add click event to populate input
            exampleCard.addEventListener('click', () => {
                rawAdInput.value = example.raw;
                formatAd();
            });
            
            examplesGrid.appendChild(exampleCard);
        });

        // Format ad function
        function formatAd() {
            const rawText = rawAdInput.value.trim();
            if (!rawText) {
                formattedOutput.textContent = "Please enter an ad to format.";
                categoryOutput.textContent = "";
                categoryOutput.className = "category-box";
                rejectionReason.textContent = "";
                return;
            }

            // Process the ad
            const result = processAd(rawText);
            
            // Store current ad data for manual editing
            currentAdData = {
                purpose: result.purpose || "",
                category: result.category || "",
                price: result.price || "",
                item: result.item || "",
                formattedAd: result.formattedAd || ""
            };
            
            // Display results
            formattedOutput.textContent = result.formattedAd;
            categoryOutput.textContent = `Category: ${result.category}`;
            categoryOutput.className = `category-box category-${result.category.toLowerCase().replace(' ', '-')}`;
            
            if (result.rejectionReason) {
                rejectionReason.textContent = `Rejection Reason: ${result.rejectionReason}`;
            } else {
                rejectionReason.textContent = "";
            }
        }

        // Clear function
        function clearAll() {
            rawAdInput.value = "";
            formattedOutput.textContent = "Your formatted ad will appear here...";
            categoryOutput.textContent = "";
            categoryOutput.className = "category-box";
            rejectionReason.textContent = "";
            manualEditSection.style.display = "none";
            validationIndicator.textContent = "";
            validationIndicator.className = "validation-indicator";
        }

        // Copy to clipboard
        function copyToClipboard() {
            const text = formattedOutput.textContent;
            if (text && text !== "Your formatted ad will appear here...") {
                navigator.clipboard.writeText(text).then(() => {
                    showNotification("Copied to clipboard!");
                }).catch(err => {
                    showNotification("Failed to copy to clipboard", "error");
                });
            } else {
                showNotification("Nothing to copy", "warning");
            }
        }

        // Manual edit function
        function toggleManualEdit() {
            if (manualEditSection.style.display === "none") {
                // Populate manual edit fields with current ad data
                manualPurpose.value = currentAdData.purpose || "Selling";
                manualCategory.value = currentAdData.category || "Other";
                manualPrice.value = currentAdData.price || "";
                manualItem.value = currentAdData.item || "";
                
                manualEditSection.style.display = "block";
            } else {
                manualEditSection.style.display = "none";
            }
        }

        // Apply manual changes
        function applyManualChanges() {
            const purpose = manualPurpose.value;
            const category = manualCategory.value;
            const price = manualPrice.value;
            const item = manualItem.value;
            
            // Build the ad based on manual inputs
            let formattedAd = "";
            
            if (purpose === "Looking for" || purpose === "Hiring") {
                formattedAd = `${purpose} ${item}.`;
            } else if (purpose === "Renting out") {
                formattedAd = `${purpose} ${item}. Rent: ${price || "Negotiable"}.`;
            } else {
                formattedAd = `${purpose} ${item}. ${purpose.includes("Buying") ? "Budget" : "Price"}: ${price || "Negotiable"}.`;
            }
            
            // Update the output
            formattedOutput.textContent = formattedAd;
            categoryOutput.textContent = `Category: ${category}`;
            categoryOutput.className = `category-box category-${category.toLowerCase().replace(' ', '-')}`;
            rejectionReason.textContent = "";
            
            // Hide manual edit section
            manualEditSection.style.display = "none";
        }

        // Cancel manual edit
        function cancelManualEdit() {
            manualEditSection.style.display = "none";
        }

        // Search functionality
        function searchRules() {
            const query = searchInput.value.toLowerCase().trim();
            if (!query) return;
            
            // Search in examples
            const matchingExamples = exampleAds.filter(example => 
                example.raw.toLowerCase().includes(query) || 
                example.formatted.toLowerCase().includes(query) ||
                example.category.toLowerCase().includes(query)
            );
            
            if (matchingExamples.length > 0) {
                // Populate examples with search results
                examplesGrid.innerHTML = "";
                matchingExamples.forEach(example => {
                    const exampleCard = document.createElement('div');
                    exampleCard.className = 'example-card';
                    
                    const rawText = document.createElement('div');
                    rawText.className = 'example-raw';
                    rawText.textContent = `Raw: ${example.raw}`;
                    
                    const formattedText = document.createElement('div');
                    formattedText.className = 'example-formatted';
                    formattedText.textContent = `Formatted: ${example.formatted}`;
                    
                    const categoryText = document.createElement('div');
                    categoryText.className = 'example-category';
                    categoryText.textContent = `Category: ${example.category}`;
                    
                    exampleCard.appendChild(rawText);
                    exampleCard.appendChild(formattedText);
                    exampleCard.appendChild(categoryText);
                    
                    exampleCard.addEventListener('click', () => {
                        rawAdInput.value = example.raw;
                        formatAd();
                    });
                    
                    examplesGrid.appendChild(exampleCard);
                });
                
                showNotification(`Found ${matchingExamples.length} matching examples`, "success");
            } else {
                showNotification("No matching examples found", "warning");
            }
        }

        // Real-time validation
        function validateInput() {
            const text = rawAdInput.value.toLowerCase();
            validationIndicator.textContent = "";
            validationIndicator.className = "validation-indicator";
            
            if (!text) return;
            
            // Check for illegal items
            for (const item of illegalItems) {
                if (text.includes(item)) {
                    validationIndicator.textContent = "⚠️ Contains illegal/prohibited content";
                    validationIndicator.className = "validation-indicator validation-error";
                    return;
                }
            }
            
            // Check for multiple vehicles
            const vehicleCount = (text.match(/(?:car|vehicle|motorcycle|bike|boat)/gi) || []).length;
            if (vehicleCount > 1 && !text.includes('trading')) {
                validationIndicator.textContent = "⚠️ Multiple vehicles detected";
                validationIndicator.className = "validation-indicator validation-error";
                return;
            }
            
            // Check for multiple properties
            const propertyCount = (text.match(/(?:house|apartment|penthouse|mansion)/gi) || []).length;
            if (propertyCount > 1) {
                validationIndicator.textContent = "⚠️ Multiple properties detected";
                validationIndicator.className = "validation-indicator validation-error";
                return;
            }
            
            validationIndicator.textContent = "✓ Valid ad format";
            validationIndicator.className = "validation-indicator validation-ok";
        }

        // Process ad according to LifeInvader policy
        function processAd(rawAd) {
            // Convert to lowercase for easier processing
            const lowerAd = rawAd.toLowerCase();
            
            // Check for illegal items first
            for (const item of illegalItems) {
                if (lowerAd.includes(item)) {
                    return {
                        formattedAd: "Cannot promote illegal items.",
                        category: "Rejected",
                        rejectionReason: "Cannot promote illegal items."
                    };
                }
            }
            
            // Initialize result
            let formattedAd = "";
            let category = "Other";
            let rejectionReason = "";
            let purpose = "";
            let price = "";
            let item = "";
            
            // Check for buying/selling/trading keywords
            const isBuying = lowerAd.includes('buy') || lowerAd.includes('purchas');
            const isSelling = lowerAd.includes('sell');
            const isTrading = lowerAd.includes('trad');
            const isRenting = lowerAd.includes('rent');
            const isLooking = lowerAd.includes('look') && lowerAd.includes('for');
            const isHiring = lowerAd.includes('hir');
            
            // Extract price/budget information
            const priceMatch = rawAd.match(/(\d+(?:\.\d+)?)\s*(?:mil|million|m|k| thousand)/i);
            if (priceMatch) {
                const amount = priceMatch[1];
                const unit = priceMatch[0].toLowerCase().includes('k') ? 'k' : 'm';
                
                if (unit === 'k') {
                    price = `$${(parseFloat(amount) * 1000).toLocaleString()}`;
                } else {
                    price = `$${amount} Million`;
                }
            }
            
            // Determine category and format accordingly
            if (lowerAd.includes('house') || lowerAd.includes('apartment') || lowerAd.includes('penthouse') || lowerAd.includes('mansion')) {
                category = "Real Estate";
                formattedAd = formatRealEstateAd(rawAd, isBuying, isSelling, isRenting);
                purpose = isBuying ? "Buying" : isSelling ? "Selling" : isRenting ? "Renting out" : "";
            } else if (lowerAd.includes('car') || lowerAd.includes('vehicle') || lowerAd.includes('motorcycle') || 
                      lowerAd.includes('bike') || lowerAd.includes('boat') || lowerAd.includes('helicopter') || 
                      lowerAd.includes('plane')) {
                category = "Auto";
                formattedAd = formatAutoAd(rawAd, isBuying, isSelling, isTrading);
                purpose = isBuying ? "Buying" : isSelling ? "Selling" : isTrading ? "Trading" : "";
                item = extractItem(rawAd, vehicleDatabase);
            } else if (lowerAd.includes('business') || lowerAd.includes('biz') || lowerAd.includes('store') || 
                      lowerAd.includes('shop') || lowerAd.includes('station') || lowerAd.includes('company')) {
                category = "Business";
                formattedAd = formatBusinessAd(rawAd, isBuying, isSelling, isTrading);
                purpose = isBuying ? "Buying" : isSelling ? "Selling" : isTrading ? "Trading" : "";
            } else if (lowerAd.includes('work') || lowerAd.includes('job') || lowerAd.includes('hire') || 
                      lowerAd.includes('salary') || lowerAd.includes('construction')) {
                category = "Work";
                formattedAd = formatWorkAd(rawAd, isBuying, isSelling);
                purpose = isHiring ? "Hiring" : "Looking for work";
            } else if (isLooking && (lowerAd.includes('for') || lowerAd.includes('dating'))) {
                category = "Dating";
                formattedAd = formatDatingAd(rawAd);
                purpose = "Looking for";
                item = extractName(rawAd);
            } else if (lowerAd.includes('discount') || lowerAd.includes('off') || lowerAd.includes('%')) {
                category = "Discounts";
                formattedAd = formatDiscountAd(rawAd);
            } else if (lowerAd.includes('service') || lowerAd.includes('template')) {
                category = "Services";
                formattedAd = formatServiceAd(rawAd);
            } else {
                category = "Other";
                formattedAd = formatOtherAd(rawAd, isBuying, isSelling, isTrading);
                purpose = isBuying ? "Buying" : isSelling ? "Selling" : isTrading ? "Trading" : "";
                item = extractItem(rawAd, clothingDatabase);
            }
            
            // Apply general formatting rules
            formattedAd = applyGeneralFormatting(formattedAd, isBuying, isSelling, isTrading, isRenting);
            
            return {
                formattedAd,
                category,
                rejectionReason,
                purpose,
                price,
                item
            };
        }

        // Extract item name from ad
        function extractItem(ad, database) {
            for (const item of database) {
                if (ad.toLowerCase().includes(item.toLowerCase())) {
                    return item;
                }
            }
            return "";
        }

        // Extract name from dating ad
        function extractName(ad) {
            const nameMatch = ad.match(/looking for\s+([a-z]+\s+[a-z]+)/i);
            if (nameMatch) {
                const name = nameMatch[1];
                return name.split(' ').map(word => 
                    word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()
                ).join(' ');
            }
            return "";
        }

        // Format real estate ads
        function formatRealEstateAd(ad, isBuying, isSelling, isRenting) {
            let formatted = ad;
            
            // Extract house number if mentioned
            const numberMatch = ad.match(/(?:house|apartment|penthouse|mansion)\s*(?:no|number|#)?\s*(\d+)/i);
            const number = numberMatch ? numberMatch[1] : null;
            
            // Standardize terms
            formatted = formatted.replace(/casino apartment/gi, "Casino penthouse");
            formatted = formatted.replace(/garden/gi, "a garden");
            formatted = formatted.replace(/garage space/gi, "g.s.");
            formatted = formatted.replace(/warehouse/gi, "w.h.");
            
            // Apply proper capitalization for locations
            const locations = [
                'Vinewood Hills', 'Rockford Hills', 'Richman', 'Sandy Shores', 'Paleto Bay',
                'Mirror Park', 'Lifeinvader', 'Del Perro', 'Cayo Perico', 'Raton Canyon'
            ];
            
            locations.forEach(location => {
                const regex = new RegExp(location.toLowerCase(), 'gi');
                formatted = formatted.replace(regex, location);
            });
            
            // Add number symbol if number is present
            if (number) {
                formatted = formatted.replace(new RegExp(`(house|apartment|penthouse|mansion)\\s*(?:no|number|#)?\\s*${number}`, 'i'), `$1 №${number}`);
            }
            
            return formatted;
        }

        // Format auto ads
        function formatAutoAd(ad, isBuying, isSelling, isTrading) {
            let formatted = ad;
            
            // Extract vehicle name and put in quotes
            const vehicleMatch = ad.match(/(?:selling|buying|trading)\s+([^.,]+?)(?:\s+with|\s+for|\.|$)/i);
            if (vehicleMatch) {
                const vehicleName = vehicleMatch[1].trim();
                // Check if vehicle is in database
                const foundVehicle = vehicleDatabase.find(v => 
                    v.toLowerCase().includes(vehicleName.toLowerCase()) || 
                    vehicleName.toLowerCase().includes(v.toLowerCase())
                );
                
                if (foundVehicle) {
                    // Check if vehicle is non-sellable
                    if (nonSellableVehicles.some(nsv => 
                        nsv.toLowerCase().includes(foundVehicle.toLowerCase()) || 
                        foundVehicle.toLowerCase().includes(nsv.toLowerCase())
                    )) {
                        return {
                            formattedAd: "Cannot advertise this vehicle is non sellable.",
                            category: "Rejected",
                            rejectionReason: "Cannot advertise this vehicle is non sellable."
                        };
                    }
                    
                    formatted = formatted.replace(vehicleName, `"${foundVehicle}"`);
                } else {
                    formatted = formatted.replace(vehicleName, `"${vehicleName}"`);
                }
            }
            
            // Standardize terms
            formatted = formatted.replace(/max config|max tuning|fully upgraded/gi, "with full configuration");
            formatted = formatted.replace(/nearly max|part lvl3|lvl3 or below/gi, "with partial configuration");
            formatted = formatted.replace(/body upgrades|body kit/gi, "with visual upgrades");
            formatted = formatted.replace(/turbo/gi, "turbo kit");
            formatted = formatted.replace(/drift tuning|drift assistance/gi, "drift kit");
            formatted = formatted.replace(/luminous rims|unique wheels/gi, "luminous wheels");
            
            return formatted;
        }

        // Format business ads
        function formatBusinessAd(ad, isBuying, isSelling, isTrading) {
            let formatted = ad;
            
            // Standardize business names
            formatted = formatted.replace(/gun store|weapon store/gi, "Ammunition Store");
            formatted = formatted.replace(/strip club/gi, "Bar");
            formatted = formatted.replace(/binco|suburban/gi, "Clothing shop");
            formatted = formatted.replace(/charging station/gi, "Electric station");
            formatted = formatted.replace(/barber/gi, "Hair salon");
            formatted = formatted.replace(/drug lab/gi, "Burger shop");
            formatted = formatted.replace(/personal business/gi, "private business");
            
            // Extract business number if mentioned
            const numberMatch = ad.match(/(?:store|shop|station|business)\s*(?:no|number|#)?\s*(\d+)/i);
            const number = numberMatch ? numberMatch[1] : null;
            
            // Add number symbol if number is present
            if (number) {
                formatted = formatted.replace(new RegExp(`(store|shop|station|business)\\s*(?:no|number|#)?\\s*${number}`, 'i'), `$1 №${number}`);
            }
            
            return formatted;
        }

        // Format work ads
        function formatWorkAd(ad, isBuying, isSelling) {
            let formatted = ad;
            
            // Standardize terms
            formatted = formatted.replace(/level/gi, "years experience");
            formatted = formatted.replace(/exotic dancer|striper/gi, "Professional dancer");
            
            // Extract construction site number if mentioned
            const siteMatch = ad.match(/construction site\s*(?:no|number|#)?\s*(\d+)/i);
            const siteNumber = siteMatch ? siteMatch[1] : null;
            
            // Add site details if number is present
            if (siteNumber) {
                const sites = {
                    "1": "on Vespucci Boulevard",
                    "2": "on Calais Avenue",
                    "3": "in Pillbox Hill"
                };
                
                if (sites[siteNumber]) {
                    formatted = formatted.replace(/construction site.*?(?=\.|$)/i, `construction site №${siteNumber}, ${sites[siteNumber]}`);
                }
            }
            
            return formatted;
        }

        // Format dating ads
        function formatDatingAd(ad) {
            let formatted = ad;
            
            // Capitalize names
            const nameMatch = ad.match(/looking for\s+([a-z]+\s+[a-z]+)/i);
            if (nameMatch) {
                const name = nameMatch[1];
                const capitalizedName = name.split(' ').map(word => 
                    word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()
                ).join(' ');
                formatted = formatted.replace(name, capitalizedName);
            }
            
            return formatted;
        }

        // Format discount ads
        function formatDiscountAd(ad) {
            let formatted = ad;
            
            // Ensure percentage format is correct
            formatted = formatted.replace(/(\d+)%\s*(?:discount|off)/gi, "$1% discount");
            
            return formatted;
        }

        // Format service ads
        function formatServiceAd(ad) {
            let formatted = ad;
            
            // Ensure proper capitalization
            formatted = formatted.charAt(0).toUpperCase() + formatted.slice(1);
            
            return formatted;
        }

        // Format other ads
        function formatOtherAd(ad, isBuying, isSelling, isTrading) {
            let formatted = ad;
            
            // Standardize terms
            formatted = formatted.replace(/crates|cases/gi, "containers");
            formatted = formatted.replace(/spray cans|spray balloons/gi, "paint cans");
            formatted = formatted.replace(/extras/gi, "of type");
            formatted = formatted.replace(/scarf/gi, "mask");
            formatted = formatted.replace(/pumpkin|cabbage|pineapple|mandarin/gi, "fruits, vegetables or seeds");
            formatted = formatted.replace(/unique 6 rims/gi, "luminous wheels of type 6");
            
            return formatted;
        }

        // Apply general formatting rules
        function applyGeneralFormatting(ad, isBuying, isSelling, isTrading, isRenting) {
            let formatted = ad;
            
            // Capitalize first letter
            formatted = formatted.charAt(0).toUpperCase() + formatted.slice(1);
            
            // Ensure proper ending punctuation
            if (!formatted.endsWith('.') && !formatted.endsWith('!') && !formatted.endsWith('?')) {
                formatted += '.';
            }
            
            // Standardize price format
            formatted = formatted.replace(/(price|budget|rent):\s*(\d)/gi, '$1: $2');
            
            // Remove trailing periods after numbers
            formatted = formatted.replace(/(\$\d[\d,.]*)\s*\.(\s|$)/g, '$1$2');
            
            return formatted;
        }

        // Event listeners
        formatBtn.addEventListener('click', formatAd);
        clearBtn.addEventListener('click', clearAll);
        copyBtn.addEventListener('click', copyToClipboard);
        manualEditBtn.addEventListener('click', toggleManualEdit);
        applyManualBtn.addEventListener('click', applyManualChanges);
        cancelManualBtn.addEventListener('click', cancelManualEdit);
        searchBtn.addEventListener('click', searchRules);
        rawAdInput.addEventListener('input', validateInput);

        // Allow Enter key to trigger search
        searchInput.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') {
                searchRules();
            }
        });

        // Initialize with a sample ad
        rawAdInput.value = "selling annis rx7 with max tuning, visual upgrades and insurance. price 15 million";
        formatAd();
    </script>
</body>
</html>
