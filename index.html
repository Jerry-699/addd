<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Lifeinvader Ads — EN-03 • Advanced Auto-Detect</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0f1720;--panel:#121a24;--ink:#e6eef7;--muted:#9fb1c5;--chip:#1c2733;
  --brand:#4da3ff;--ok:#2ecc71;--warn:#ffb020;--bad:#ff5a5a;--btn:#1b6fe7;
  --btn-ink:#fff;--line:#203040;--accent:#2a3848;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink);line-height:1.45}
.wrap{max-width:980px;margin:40px auto;padding:0 16px}
h1{font-size:20px;margin:0 0 14px;display:flex;gap:8px;align-items:center}
h1 .bolt{color:#ffd166}
.card{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:16px}
.row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
textarea,input,select{width:100%;background:#0c1219;color:var(--ink);border:1px solid var(--accent);border-radius:10px;padding:12px;font:inherit;outline:none}
textarea{min-height:150px;resize:vertical}
.btn{background:var(--btn);color:var(--btn-ink);border:0;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer}
.btn.secondary{background:#1f2a36}
.btn.ghost{background:transparent;border:1px solid var(--accent)}
.btn:disabled{opacity:.6;cursor:not-allowed}
.out{background:#0c1219;border:1px dashed var(--accent);padding:12px;border-radius:10px;min-height:44px;white-space:pre-wrap}
.chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
.chip{background:var(--chip);color:var(--muted);padding:6px 10px;border-radius:999px;font-size:12px;border:1px solid var(--accent)}
.chip.ok{color:#bff3cf;border-color:#294e3a;background:#15251c}
.chip.bad{color:#ffd3d3;border-color:#4a2626;background:#241212}
.chip.warn{color:#fff0c2;border-color:#4a4126;background:#241f12}
.muted{color:var(--muted)}
.two{display:grid;grid-template-columns:1fr;gap:14px}
@media(min-width:840px){.two{grid-template-columns:1fr 1fr}}
.kicker{font-size:12px;color:var(--muted);margin:6px 0 0}
.bar{display:flex;gap:8px;align-items:center;margin-top:10px}
.right{margin-left:auto}
.tiny{font-size:11px}
.foot{margin-top:24px;font-size:12px;color:var(--muted)}
.examples{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:10px;margin-top:15px}
.example-card{background:#0c1219;border:1px solid var(--accent);border-radius:8px;padding:12px;cursor:pointer;transition:all 0.2s}
.example-card:hover{background:#131c26}
.example-raw{font-size:12px;color:var(--muted);margin-bottom:6px}
.example-result{font-size:13px;font-weight:500}
.hidden{display:none}
.stats{margin-top:8px;font-size:11px;color:var(--muted)}
</style>
</head>
<body>
<div class="wrap">
  <h1><span class="bolt">⚡</span> Lifeinvader Ad Formatter EN-03</h1>
  <p class="muted tiny">Advanced auto-detection with manual correction. Uses comprehensive policy rules.</p>

  <div class="card">
    <label class="muted tiny">RAW AD TEXT</label>
    <textarea id="raw" placeholder="e.g., selling annis rx7 with max tuning • buying house with garden • hiring solar workers"></textarea>
    <div class="bar">
      <button id="gen" class="btn">Generate</button>
      <button id="clear" class="btn secondary">Clear</button>
      <span class="right tiny muted" id="status">Ready.</span>
    </div>

    <div style="height:10px"></div>

    <div class="out" id="out">Your formatted ad will appear here…</div>
    <div class="bar">
      <button id="copy" class="btn ghost">Copy</button>
      <div id="badges" class="chips"></div>
    </div>
  </div>

  <div style="height:18px"></div>

  <div class="card">
    <h3 style="margin:0 0 10px">Manual Correction</h3>
    <p class="muted tiny">Auto-detected values. Edit and apply corrections.</p>

    <div class="two">
      <div>
        <label class="muted tiny">Action</label>
        <select id="mfOpener">
          <option value="auto">Auto-detect</option>
          <option>Buying</option>
          <option>Selling</option>
          <option>Trading</option>
          <option>Selling or trading</option>
          <option>Renting out</option>
          <option>Hiring</option>
          <option>Looking to work</option>
          <option>Looking for</option>
          <option>Party at</option>
        </select>
      </div>
      <div>
        <label class="muted tiny">Money Type</label>
        <select id="mfMoneyLabel">
          <option value="auto">Auto-detect</option>
          <option>Price</option>
          <option>Budget</option>
          <option>Rent</option>
          <option>Salary</option>
          <option>Bet</option>
          <option>None</option>
        </select>
      </div>
      <div>
        <label class="muted tiny">Subject</label>
        <input id="mfSubject" placeholder='e.g., "Annis RX-7 (FD)" with full configuration'>
      </div>
      <div>
        <label class="muted tiny">Amount</label>
        <input id="mfAmount" placeholder='e.g., 20k, 1.5m, Negotiable'>
        <div class="kicker tiny muted">k=thousands (20k→$20.000), m=millions (1.5m→$1.5 Million)</div>
      </div>
    </div>

    <div class="bar" style="margin-top:14px">
      <button id="apply" class="btn secondary">Apply</button>
      <button id="applySave" class="btn">Apply &amp; Save Rule</button>
      <label class="right tiny"><input id="autoRules" type="checkbox" checked> Auto-apply saved rules</label>
    </div>

    <div class="kicker tiny muted" id="rulesInfo">No rules saved yet.</div>
  </div>

  <div style="height:18px"></div>

  <div class="card">
    <h3 style="margin:0 0 10px">Quick Examples</h3>
    <p class="muted tiny">Click any example to test the formatter</p>
    
    <div class="examples" id="examples">
      <!-- Examples will be populated by JavaScript -->
    </div>
  </div>

  <div class="foot">
    EN-03 Policy Compliant: Proper capitalization, price formatting, business naming, blacklist enforcement, category detection.
  </div>
</div>

<script>
// DOM elements
const $ = s => document.querySelector(s);
const rawEl = $("#raw"), outEl = $("#out"), statusEl = $("#status"), badgesEl = $("#badges");
const mfOpener = $("#mfOpener"), mfSubject = $("#mfSubject"), mfMoney = $("#mfMoneyLabel"), mfAmount = $("#mfAmount");
const btnGen = $("#gen"), btnClear = $("#clear"), btnCopy = $("#copy"), btnApply = $("#apply"), btnApplySave = $("#applySave"), chkAuto = $("#autoRules");
const examplesEl = $("#examples");

// Comprehensive catalog with all LifeInvader rules
const CATALOG = {
  blacklist: [
    "firearm", "gun", "pistol", "rifle", "shotgun", "ammo", "ammunition", "bulletproof", "armor plate",
    "weed", "cannabis", "marijuana", "cocaine", "drug", "balaclava", "covid mask", "ems mask", "surgical mask",
    "radar", "scanner", "anti-radar", "head bag", "rope", "crowbar", "usb with virus", "troll ad",
    "animal skin", "barricade", "satellite dish", "engine block", "air horn", "grand coin", "battlepass",
    "nationality", "sexual", "sell people", "hype body", "branded armor", "gang", "black market", "mega mall"
  ],
  
  banned_party_places: ["lspd", "fib", "sahp", "ems", "government", "ghetto", "mega mall", "black market", "gang hq"],
  
  nonsellable_autos: [
    "p1 car", "benefactor maybach gls 600", "annnis concept 2021", "brabus rocket", "overflod jesko"
  ],

  business_map: {
    "barber": "Hair salon business", "barber shop": "Hair salon business", "hair salon": "Hair salon business",
    "gun store": "Ammunition Store business", "weapon shop": "Ammunition Store business", "weapon store": "Ammunition Store business",
    "drug lab": "Burger shop business", "charging station": "Electric station business",
    "auto workshop": "Service station business", "service station": "Service station business",
    "24/7": "24/7 Store business", "24/7 store": "24/7 Store business", "atm": "ATM business",
    "car wash": "Car wash business", "chip tuning": "Chip tuning business", "clothing shop": "Clothing shop business",
    "cowshed": "Cowshed business", "plantation": "Plantation business", "taxi company": "Taxi company business",
    "grand elite": "Grand Elite business", "jewelry store": "Jewelry store business", "oil well": "Oil Well business",
    "parking": "Parking business", "pet shop": "Pet Shop business", "car sharing": "Car sharing business",
    "state object": "State object business", "tattoo studio": "Tattoo studio business", "gas station": "Gas station business",
    "burger shop": "Burger shop business", "warehouse": "Warehouse business", "freight train": "Freight train business",
    "flower shop": "Flower shop business", "electric station": "Electric station business", "farm": "Farm business",
    "juice shop": "Juice shop business", "fight club": "Fight club business"
  },

  vehicle_synonyms: {
    "supra": "Karin Supra A80", "rx7": "Annis RX-7 (FD)", "r34": "Annis Skyline GT-R (R34)",
    "silvia": "Annis Silvia (S15)", "chiron": "Truffade Chiron", "gtr": "Annis Skyline GT-R (R34)",
    "porsche": "Pfister", "bmw": "Ubermacht", "mercedes": "Benefactor", "audi": "Obey"
  },

  official_places: [
    "Vinewood Hills", "Rockford Hills", "Richman", "Sandy Shores", "Paleto Bay", "Postal", "Hospital", "Capitol",
    "Fire Station", "Auto Fair", "Bahama Mamas Bar", "Tequi-la-la Bar", "FIB", "Hotel Spa Bar",
    "Pacific Bluffs Country Club", "Diamond Resort Bar", "Vanilla Unicorn Bar", "Church", "Stock Exchange",
    "Stadium", "Chumash", "Lifeinvader", "Del Perro Pier", "Del Perro Beach", "Cayo Perico Island",
    "Hotel", "Raton Canyon", "School", "SAHP"
  ],
  
  unofficial_places: ["airport", "autosalon", "beach", "beach market", "post office", "train station", "yacht", "ghetto"]
};

// Example ads for testing
const EXAMPLE_ADS = [
  { raw: "selling monowheel budget 2.5m", result: 'Selling "Monowheel". Price: $2.5 Million.', category: "Auto" },
  { raw: "I want to but a penthouse. My budget is 20 mil", result: "Buying Casino penthouse. Budget: $20 Million.", category: "Real Estate" },
  { raw: "selling house 71 and 1008. Price nego", result: "Cannot advertise more than 1 property at a time.", category: "Rejected" },
  { raw: "buying a biz. Budget 150 mil", result: "Buying a private business. Budget: $150 Million.", category: "Business" },
  { raw: "looking Anindo winslow", result: "Looking for Anindo Winslow.", category: "Dating" },
  { raw: "i am a lawyer, i need work", result: "Lawyer looking for work.", category: "Work" },
  { raw: "sell supra, price 10 mil", result: 'Selling "Karin Supra A80". Price: $10 Million.', category: "Auto" },
  { raw: "buying p1. Budget nego", result: "Cannot advertise this vehicle is non sellable.", category: "Rejected" },
  { raw: "party at fib", result: "Cannot promote parties at FIB.", category: "Rejected" },
  { raw: "buying seed bulk. 2500 each", result: "Buying seeds in bulk. Budget: $2.500 each.", category: "Other" },
  { raw: "i need cocain. 8k each.", result: "Cannot promote illegal items.", category: "Rejected" },
  { raw: "Selling house 503, garden, 25 garage, swimming pool, custom interior in mirror park. Price : 50 mil", 
    result: "Selling house №503 with a garden, 25 g.s., custom interior and swimming pool in Mirror Park. Price: $50 Million.", 
    category: "Real Estate" }
];

// Utility functions
function status(m) { statusEl.textContent = m; }
function clearBadges() { badgesEl.innerHTML = ""; }
function badge(t, c = "") { 
  const s = document.createElement("span"); 
  s.className = "chip " + c; 
  s.textContent = t; 
  badgesEl.appendChild(s); 
}

function copyText(s) { 
  navigator.clipboard.writeText(s || "").then(() => status("Copied!")); 
}

function dotThousands(n) { 
  return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, "."); 
}

function asMoney(raw) {
  if (!raw) return "Negotiable";
  raw = raw.trim();
  if (/^negotiable$/i.test(raw)) return "Negotiable";
  
  const each = /\beach\b/i.test(raw) ? " each" : "";
  const per = /\bper\s*(week|day|month)\b/i.exec(raw);
  const perTxt = per ? ` per ${per[1]}` : "";
  let s = raw.replace(/\$/g, "").replace(/,/g, "").trim();

  let m;
  if ((m = s.match(/^(\d+(?:\.\d+)?)\s*m/i))) {
    const v = parseFloat(m[1]); 
    return `$${v} Million${each}${perTxt}`;
  }
  if ((m = s.match(/^(\d+(?:\.\d+)?)\s*k/i))) {
    const v = Math.round(parseFloat(m[1]) * 1000) + ""; 
    return `$${dotThousands(v)}${each}${perTxt}`;
  }
  if (/^\d+$/.test(s)) return `$${dotThousands(s)}${each}${perTxt}`;
  return raw;
}

// Local rules system
const RULE_KEY = "li_rules_v1";
const getRules = () => { try { return JSON.parse(localStorage.getItem(RULE_KEY) || "[]") } catch { return [] } };
const setRules = a => { localStorage.setItem(RULE_KEY, JSON.stringify(a)); showRulesInfo(); };

function showRulesInfo() { 
  const n = getRules().length; 
  $("#rulesInfo").textContent = n ? `${n} rule${n > 1 ? "s" : ""} saved. Auto-apply is ${$("#autoRules").checked ? "on" : "off"}.` : "No rules saved yet."; 
}

function applyLocalRules(s) { 
  for (const r of getRules()) { 
    try { 
      const re = new RegExp(r.pattern, "i"); 
      if (re.test(s)) s = s.replace(re, r.replacement); 
    } catch {} 
  } 
  return s; 
}

// Text processing functions
function fixTypos(s) {
  let t = ` ${s.toLowerCase()} `;
  t = t.replace(/\booking\s+work\b/g, "looking to work");
  t = t.replace(/\bi want to but\b/g, "i want to buy");
  t = t.replace(/\brp\s*ticket\b/g, "grand ticket");
  t = t.replace(/\bcrypto\s*currency\b/g, "tokens");
  t = t.replace(/\bseed bulk\b/g, "seeds in bulk");
  t = t.replace(/\bparty at\s+fib\b/g, "party at fib");
  return t.trim();
}

function levelToQuality(s) {
  return s
    .replace(/\bmax\s+level\b/ig, "max quality")
    .replace(/\b(?:level|lvl)\s*1\b/ig, "low quality")
    .replace(/\b(?:level|lvl)\s*2\b/ig, "medium quality")
    .replace(/\b(?:level|lvl)\s*3\b/ig, "high quality")
    .replace(/\b(?:level|lvl)\s*4\b/ig, "max quality");
}

function sentenceCase(s) { 
  s = s.trim(); 
  return s ? s[0].toUpperCase() + s.slice(1) : s; 
}

// Detection functions
function detectBlacklist(s) {
  const low = s.toLowerCase();
  for (const w of CATALOG.blacklist) { 
    if (low.includes(w)) return { reject: true, reason: `Contains illegal/blacklisted term: "${w}"` }; 
  }
  
  for (const v of CATALOG.nonsellable_autos) { 
    if (low.includes(v.toLowerCase())) return { reject: true, reason: `Non-sellable vehicle: "${v}"` }; 
  }
  
  if (/\bparty at\b/.test(low) && CATALOG.banned_party_places.some(p => low.includes(p))) {
    return { reject: true, reason: "We do not promote parties at that location." };
  }
  
  return { reject: false };
}

function detectOpener(s) {
  const low = s.toLowerCase();
  if (/\brenting out\b/.test(low) || /\brent out\b/.test(low)) return "Renting out";
  if (/\bhiring\b/.test(low)) return "Hiring";
  if (/\blooking to work\b/.test(low) || /\blooking for work\b/.test(low)) return "Looking to work";
  if (/\blooking for\b/.test(low)) return "Looking for";
  if (/\bbuying\b/.test(low) || /\bi want to buy\b/.test(low)) return "Buying";
  if (/\bselling or trading\b/.test(low)) return "Selling or trading";
  if (/\btrading\b/.test(low)) return "Trading";
  if (/\bselling\b/.test(low)) return "Selling";
  if (/\bparty at\b/.test(low)) return "Party at";
  return "Selling";
}

function detectCategory(s) {
  const low = s.toLowerCase();
  if (/\bhouse|apartment|penthouse|mansion\b/.test(low) || /\bg\.s\.|w\.h\.|helipad|garden\b/.test(low)) return "Real Estate";
  if (/\bbusiness\b/.test(low) || /\bcontrol\b/.test(low)) return "Business";
  for (const k of Object.keys(CATALOG.business_map)) { if (low.includes(k)) return "Business"; }
  if (/\bcar|vehicle|motorcycle|bike|boat|helicopter|plane\b/.test(low)) return "Auto";
  if (/\bhiring\b/.test(low) || /\blooking to work\b/.test(low)) return "Work";
  if (/^looking for /.test(low) || /\blooking for a (?:wife|husband|boyfriend|girlfriend|family)\b/.test(low)) return "Dating";
  if (/\bdiscount|%\s*off\b/.test(low)) return "Discounts";
  if (/\bservice|template|gps\s*№\b/.test(low)) return "Services";
  return "Other";
}

function moneyLabelForOpener(opener) {
  switch (opener) {
    case "Buying": return "Budget";
    case "Selling": return "Price";
    case "Renting out": return "Rent";
    case "Hiring": return "Salary";
    default: return "None";
  }
}

function extractMoneyRaw(s) {
  if (/\bnego|negotiable\b/i.test(s)) return "Negotiable";
  const m = s.match(/\$?\s*\d+(?:\.\d+)?\s*[km]?\b(?:\s*each|\s*per\s*(?:week|day|month))?/i);
  return m ? m[0].trim() : "";
}

// Normalization functions
function normalizeBusinessSubject(raw) {
  let low = raw.toLowerCase();
  low = low.replace(/personal business/g, "private business");
  for (const [k, canon] of Object.entries(CATALOG.business_map)) {
    const re = new RegExp(`\\b${k}\\b`, "i");
    if (re.test(low)) return sentenceCase(canon.replace(/ business$/, "")) + " business";
  }
  return "a private business";
}

function normalizeAutoSubject(raw) {
  let s = raw;
  // Apply vehicle synonyms
  for (const [k, v] of Object.entries(CATALOG.vehicle_synonyms)) {
    const re = new RegExp(`\\b${k}\\b`, "i");
    s = s.replace(re, `"${v}"`);
  }
  // Apply quality conversions
  s = levelToQuality(s);
  s = s.replace(/\bdrift (?:tuning|assistance)\b/ig, "drift kit");
  s = s.replace(/\bturbo\b/ig, "turbo kit");
  s = s.replace(/\b(body (?:upgrades|kit)|modification|visuals?)\b/ig, "visual upgrades");
  s = s.replace(/\bluminous (?:rims|unique wheels?)\b/ig, "luminous wheels");
  return sentenceCase(s);
}

function normalizeRealEstate(raw) {
  let s = raw.toLowerCase();
  
  // Check for multiple properties
  const nums = [...s.matchAll(/\b(?:no|№)?\s*(\d{1,5})\b/g)].map(m => m[1]);
  if (/house/.test(s) && nums.length > 1) {
    return { reject: true, reason: "Cannot advertise more than 1 property number at a time." };
  }

  const typ = s.match(/\b(house|apartment|penthouse|mansion)\b/);
  const type = typ ? typ[1] : "house";
  
  let num = "";
  const n = s.match(/\b(?:house|apartment|penthouse|mansion)?\s*(?:no|№)\s*(\d{1,5})\b/);
  if (n) num = ` №${n[1]}`;

  const feats = [];
  if (/\bgarden\b/.test(s)) feats.push("a garden");
  
  let gs = "";
  const mgs = s.match(/\b(2|5|9|25)\s*(?:g\.?s\.?|garage)\b/);
  if (mgs) gs = mgs[1] + " g.s.";
  if (gs) feats.push(gs);

  if (/\bcustom\s*interior\b/.test(s)) feats.push("custom interior");
  if (/\binsurance\b/.test(s)) feats.push("insurance");

  let subject = `a ${type}${num}`;
  if (feats.length) {
    const last = feats.pop();
    subject += " with " + (feats.length ? feats.join(", ") + " and " : "") + last;
  }
  
  return sentenceCase(subject);
}

// Main generation function
function generate() {
  clearBadges();
  let raw = rawEl.value.trim();
  if (!raw) { outEl.textContent = ""; status("Type a raw ad."); return; }

  // Apply saved rules if enabled
  if (chkAuto.checked) raw = applyLocalRules(raw);

  let processed = fixTypos(raw);
  processed = levelToQuality(processed);

  // Check for blacklisted content
  const blk = detectBlacklist(processed);
  if (blk.reject) {
    outEl.textContent = `⚠️ Rejected: ${blk.reason}`;
    badge("Rejected", "bad");
    return;
  }

  const category = detectCategory(processed);
  let opener = mfOpener.value === "auto" ? detectOpener(processed) : mfOpener.value;
  let moneyLabel = mfMoney.value === "auto" ? moneyLabelForOpener(opener) : mfMoney.value;
  
  let amount = mfAmount.value.trim();
  if (!amount) {
    const mRaw = extractMoneyRaw(processed);
    amount = asMoney(mRaw || "Negotiable");
  } else {
    amount = asMoney(amount);
  }

  let subject = mfSubject.value.trim();
  
  if (!subject) {
    let base = processed;
    base = base.replace(/\b(price|budget|rent|salary)\s*[:.]?\s*\$?\d+(?:\.\d+)?\s*[km]?/ig, "");
    base = base.replace(/\bnegotiable\b/ig, "");

    if (category === "Business") {
      subject = normalizeBusinessSubject(base);
    } else if (category === "Real Estate") {
      const r = normalizeRealEstate(base);
      if (typeof r === "object" && r.reject) {
        outEl.textContent = `⚠️ Rejected: ${r.reason}`;
        badge("Rejected", "bad");
        return;
      }
      subject = r;
    } else if (category === "Auto") {
      subject = normalizeAutoSubject(base);
    } else if (category === "Work") {
      subject = sentenceCase(base);
    } else if (category === "Dating") {
      subject = sentenceCase(base.replace(/\bhiring family members\b/i, "family members"));
    } else {
      subject = sentenceCase(base);
    }
  }

  // Special case handling
  if (/i need a (girlfriend|boyfriend)/i.test(processed)) {
    opener = "Looking for";
    subject = `a ${RegExp.$1}`;
    moneyLabel = "None";
  }

  if (/party at house\s*(?:no|№)?\s*(\d+)/i.test(processed)) {
    opener = "Party at house №" + RegExp.$1;
    moneyLabel = "None";
    subject = "";
  }

  // Build final sentence
  let sentence = "";
  if (moneyLabel === "None") {
    sentence = `${opener} ${subject}.`;
  } else {
    sentence = `${opener} ${subject}. ${moneyLabel}: ${amount}.`;
  }

  // Remove double spaces and ensure proper punctuation
  sentence = sentence.replace(/\s+/g, " ").trim();
  if (!sentence.endsWith(".")) sentence += ".";

  outEl.textContent = sentence;
  badge(`Category: ${category}`);
  badge(`Action: ${opener}`);
  if (moneyLabel !== "None") badge(`Money: ${moneyLabel}`);
  if (/Million/.test(amount) || /\$\d{1,3}(?:\.\d{3})+/.test(amount)) badge("Format OK", "ok");
  status("Generated!");
}

// Populate examples
function populateExamples() {
  examplesEl.innerHTML = "";
  EXAMPLE_ADS.forEach(ex => {
    const card = document.createElement("div");
    card.className = "example-card";
    card.innerHTML = `
      <div class="example-raw">${ex.raw}</div>
      <div class="example-result">${ex.result}</div>
      <div class="stats">${ex.category}</div>
    `;
    card.addEventListener("click", () => {
      rawEl.value = ex.raw;
      generate();
    });
    examplesEl.appendChild(card);
  });
}

// Event listeners
btnGen.addEventListener("click", generate);
btnClear.addEventListener("click", () => {
  rawEl.value = "";
  outEl.textContent = "";
  clearBadges();
  status("Cleared.");
});
btnCopy.addEventListener("click", () => copyText(outEl.textContent));
btnApply.addEventListener("click", () => { generate(); status("Applied."); });
btnApplySave.addEventListener("click", () => {
  const r = rawEl.value.trim();
  if (!r) { status("Nothing to save."); return; }
  const rules = getRules();
  const pattern = r.replace(/[.*+?^${}()|[\]\\]/g, "\\$&").slice(0, 200);
  const replacement = fixTypos(levelToQuality(r));
  rules.unshift({ pattern, replacement });
  setRules(rules);
  status("Saved rule & applied.");
  generate();
});

// Initialize
showRulesInfo();
populateExamples();

// Auto-generate when page loads with example
rawEl.value = "selling annis rx7 with max tuning, visual upgrades and insurance. price 15 million";
generate();
</script>
</body>
</html>
